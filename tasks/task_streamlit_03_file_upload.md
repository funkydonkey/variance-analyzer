# Task Streamlit 03: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é **–∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–æ–∏ CSV/XLSX —Ñ–∞–π–ª—ã** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ `test_data.csv`.

## ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
~30-45 –º–∏–Ω—É—Ç

## üß† –ß—Ç–æ —Ç—ã —É–∑–Ω–∞–µ—à—å
- –†–∞–±–æ—Ç–∞ —Å `st.file_uploader()` –≤ Streamlit
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ `session_state`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (—Ñ–æ—Ä–º–∞—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

---

## üìö –ß–∞—Å—Ç—å 1: –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ –µ—Å—Ç—å —Å–µ–π—á–∞—Å:
```python
# –í new_ui.py (—Å—Ç—Ä–æ–∫–∞ ~51)
st.session_state.analyst = VarianceAnalyst("test_data.csv")  # ‚Üê –ñ—ë—Å—Ç–∫–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–æ
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `test_data.csv`
- ‚ùå –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚ùå `st.file_uploader()` –≤ —Å–∞–π–¥–±–∞—Ä–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç—Ä–æ–∫–∞ 62)

### –ß—Ç–æ —Ö–æ—Ç–∏–º:
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ UI
uploaded_file = st.file_uploader("üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ", type=["csv", "xlsx"])

# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
# 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç –∞–≥–µ–Ω—Ç–∞ —Å –Ω–æ–≤—ã–º —Ñ–∞–π–ª–æ–º
# 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞ –≤ —Å–∞–π–¥–±–∞—Ä–µ
# 4. –û—á–∏—â–∞–µ—Ç —á–∞—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–π–ª–∞
```

---

## üèóÔ∏è –ß–∞—Å—Ç—å 2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ st.file_uploader()
   ‚Üì
2. Streamlit –¥–∞—ë—Ç –Ω–∞–º UploadedFile –æ–±—ä–µ–∫—Ç
   ‚Üì
3. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ /tmp/uploaded_data.csv (–∏–ª–∏ .xlsx)
   ‚Üì
4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º VarianceAnalyst —Å –Ω–æ–≤—ã–º –ø—É—Ç—ë–º –∫ —Ñ–∞–π–ª—É
   ‚Üì
5. –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ (—Ç.–∫. —ç—Ç–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
   ‚Üì
6. –û–±–Ω–æ–≤–ª—è–µ–º st.session_state.data_file –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ session_state:

```python
st.session_state.analyst        # –ê–≥–µ–Ω—Ç (–ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞)
st.session_state.data_file      # –ü—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É —Ñ–∞–π–ª—É
st.session_state.messages       # –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ (–æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–π–ª–∞)
st.session_state.uploaded_file_name  # –ò–º—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–¥–ª—è UI)
```

---

## ‚úçÔ∏è –ß–∞—Å—Ç—å 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–¢–´ –ü–ò–®–ï–®–¨)

### –®–∞–≥ 1: –£–ª—É—á—à–∏ file_uploader –≤ —Å–∞–π–¥–±–∞—Ä–µ

**–§–∞–π–ª:** `new_ui.py`

**–ù–∞–π–¥–∏ —ç—Ç–æ—Ç –±–ª–æ–∫ (—Å—Ç—Ä–æ–∫–∞ ~62):**
```python
with st.sidebar:
    st.title("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")

    st.file_uploader("Load new file:")  # ‚Üê –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!
```

**–ó–∞–º–µ–Ω–∏ –Ω–∞:**
```python
with st.sidebar:
    st.title("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")

    # TODO: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
    uploaded_file = st.file_uploader(
        "üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV/XLSX —Ñ–∞–π–ª",
        type=["csv", "xlsx"],
        help="–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏: account, period, actual, budget"
    )

    # TODO: –ï—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ–≥–æ
    if uploaded_file is not None:
        # –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ —Ç–æ—Ç –ª–∏ —ç—Ç–æ –∂–µ —Ñ–∞–π–ª (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞)
        # –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        # –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ —Å –Ω–æ–≤—ã–º —Ñ–∞–π–ª–æ–º
        # –®–∞–≥ 4: –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç
        # –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å session_state
        pass  # ‚Üê —Ç–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

    # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª
    if "data_file" in st.session_state:
        file_name = st.session_state.get("uploaded_file_name", "test_data.csv")
        st.info(f"üìä –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: {file_name}")
```

---

### –®–∞–≥ 2: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞

**–ì–¥–µ:** –í `new_ui.py` (–ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º UI –∫–æ–¥–æ–º)

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

```python
import tempfile
from pathlib import Path

def save_uploaded_file(uploaded_file) -> Path:
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.

    Args:
        uploaded_file: UploadedFile –æ–±—ä–µ–∫—Ç –æ—Ç st.file_uploader()

    Returns:
        Path: –ü—É—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É

    –ü–æ–¥—Å–∫–∞–∑–∫–∏:
    1. –ü–æ–ª—É—á–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: Path(uploaded_file.name).suffix
    2. –°–æ–∑–¥–∞–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: tempfile.NamedTemporaryFile(delete=False, suffix=...)
    3. –ó–∞–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ: tmp.write(uploaded_file.getbuffer())
    4. –í–µ—Ä–Ω–∏ Path –∫ —Ñ–∞–π–ª—É
    """
    # TODO: –†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é
    pass  # ‚Üê —Ç–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ–¥—Å–∫–∞–∑–∫–∞):**
```python
def save_uploaded_file(uploaded_file) -> Path:
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é."""
    # –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
    suffix = Path(uploaded_file.name).suffix

    # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    with tempfile.NamedTemporaryFile(delete=False, suffix=suffix, mode='wb') as tmp:
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        tmp.write(uploaded_file.getbuffer())
        tmp_path = Path(tmp.name)

    return tmp_path
```

---

### –®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∞–π –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞

**–ì–¥–µ:** –í –±–ª–æ–∫–µ `if uploaded_file is not None:`

**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –∏ –æ—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞.

```python
if uploaded_file is not None:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º - —ç—Ç–æ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –∏–ª–∏ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π?
    current_file_name = st.session_state.get("uploaded_file_name", None)

    if current_file_name != uploaded_file.name:
        # –≠–¢–û –ù–û–í–´–ô –§–ê–ô–õ!

        # 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        # TODO: –í—ã–∑–æ–≤–∏ save_uploaded_file()
        file_path = save_uploaded_file(uploaded_file)

        # 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –∞–≥–µ–Ω—Ç–∞
        try:
            # TODO: –°–æ–∑–¥–∞–π –Ω–æ–≤–æ–≥–æ VarianceAnalyst —Å –Ω–æ–≤—ã–º —Ñ–∞–π–ª–æ–º
            st.session_state.analyst = VarianceAnalyst(str(file_path))

            # 3. –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
            st.session_state.data_file = str(file_path)
            st.session_state.uploaded_file_name = uploaded_file.name

            # 4. –û—á–∏—â–∞–µ–º —á–∞—Ç (—Ç.–∫. —ç—Ç–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ!)
            st.session_state.messages = [
                {
                    "role": "assistant",
                    "content": f"–§–∞–π–ª **{uploaded_file.name}** —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω! –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –æ–± —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö."
                }
            ]

            # 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
            st.success(f"‚úÖ –§–∞–π–ª {uploaded_file.name} –∑–∞–≥—Ä—É–∂–µ–Ω!")

            # 6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å UI
            st.rerun()

        except Exception as e:
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            st.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: {str(e)}")
            st.error("–£–±–µ–¥–∏—Å—å —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–æ–Ω–∫–∏: account, period, actual, budget")
```

---

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∞–≥–µ–Ω—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ì–¥–µ:** –ë–ª–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ ~48-55)

**–ó–∞–¥–∞—á–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ñ–∞–π–ª —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª.

**–ù–∞–π–¥–∏:**
```python
st.session_state.data_file = "test_data.csv"

if "analyst" not in st.session_state:
    try:
        st.session_state.analyst = VarianceAnalyst(st.session_state.data_file)
    except Exception as e:
        st.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞: {str(e)}")
```

**–ó–∞–º–µ–Ω–∏ –Ω–∞:**
```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è data_file (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
if "data_file" not in st.session_state:
    st.session_state.data_file = "test_data.csv"
    st.session_state.uploaded_file_name = "test_data.csv"  # –ò–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω)
if "analyst" not in st.session_state:
    try:
        st.session_state.analyst = VarianceAnalyst(st.session_state.data_file)
    except Exception as e:
        st.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞: {str(e)}")
```

---

## üîó –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã

### st.file_uploader API

```python
uploaded_file = st.file_uploader(
    label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª",
    type=["csv", "xlsx"],  # –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    accept_multiple_files=False,  # –û–¥–∏–Ω —Ñ–∞–π–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    help="–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
)

# uploaded_file —ç—Ç–æ UploadedFile –æ–±—ä–µ–∫—Ç:
if uploaded_file is not None:
    uploaded_file.name         # –ò–º—è —Ñ–∞–π–ª–∞: "my_data.csv"
    uploaded_file.size         # –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    uploaded_file.type         # MIME type: "text/csv"
    uploaded_file.getbuffer()  # –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∫ BytesIO
```

### –†–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

```python
import tempfile
from pathlib import Path

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
with tempfile.NamedTemporaryFile(delete=False, suffix=".csv", mode='wb') as tmp:
    tmp.write(content)
    tmp_path = Path(tmp.name)

# tmp_path —Ç–µ–ø–µ—Ä—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ /tmp/tmpXXXXXX.csv
print(tmp_path)  # /tmp/tmp12345.csv
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞

```python
# –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
if uploaded_file.name.endswith(('.csv', '.xlsx')):
    # OK
    pass

# –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–∞—è —á–µ—Ä–µ–∑ suffix
suffix = Path(uploaded_file.name).suffix.lower()
if suffix not in ['.csv', '.xlsx']:
    st.error("–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞!")
```

### –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–π–ª–∞

```python
# –°–±—Ä–æ—Å–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
st.session_state.messages = [
    {
        "role": "assistant",
        "content": "–ù–æ–≤—ã–π —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω! –ß—Ç–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?"
    }
]
```

---

## üêõ Edge Cases –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 1. –§–∞–π–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
```python
try:
    analyst = VarianceAnalyst(file_path)
except ValueError as e:
    st.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ñ–∞–π–ª–∞: {str(e)}")
    st.info("üí° –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–æ–Ω–∫–∏: account, period, actual, budget")
    return  # –ù–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞
```

### 2. –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª
```python
MAX_FILE_SIZE_MB = 10

if uploaded_file.size > MAX_FILE_SIZE_MB * 1024 * 1024:
    st.error(f"‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º {MAX_FILE_SIZE_MB} –ú–ë")
    return
```

### 3. –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
```python
if uploaded_file.size == 0:
    st.error("‚ùå –§–∞–π–ª –ø—É—Å—Ç–æ–π!")
    return
```

### 4. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∏–º–µ–Ω–∏
if st.session_state.get("uploaded_file_name") == uploaded_file.name:
    # –≠—Ç–æ —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    pass
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

### –ö–æ–¥
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `save_uploaded_file()`
- [ ] `st.file_uploader()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å —Ç–∏–ø–∞–º–∏ —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π —Ñ–∞–π–ª (–Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- [ ] –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
- [ ] –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–π–ª–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–æ–∫)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `st.session_state.data_file` –∏ `uploaded_file_name`
- [ ] –í—ã–∑–æ–≤ `st.rerun()` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

### UX
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ —Å–∞–π–¥–±–∞—Ä–µ
- [ ] –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –ß–∞—Ç –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–π–ª–∞
- [ ] –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ñ–∞–π–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ XLSX —Ñ–∞–π–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å TXT —Ñ–∞–π–ª - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
- [ ] –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞ - –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç –∞–≥–µ–Ω—Ç–∞
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞ - –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç –∞–≥–µ–Ω—Ç–∞ –∏ –æ—á–∏—â–∞–µ—Ç —á–∞—Ç
- [ ] –î–µ—Ñ–æ–ª—Ç–Ω—ã–π `test_data.csv` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

---

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

**test_valid.csv:**
```csv
account,period,actual,budget
Revenue,2024-01,1000,800
COGS,2024-01,400,500
Marketing,2024-01,150,100
```

**test_invalid.csv (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫):**
```csv
wrong_column,date,value1,value2
Revenue,2024-01,1000,800
```

### 2. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
streamlit run new_ui.py
```

### 3. –¢–µ—Å—Ç-–∫–µ–π—Å—ã

**–¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–ª–∏–¥–Ω–æ–≥–æ CSV**
1. –ù–∞–∂–º–∏ "Browse files" –≤ —Å–∞–π–¥–±–∞—Ä–µ
2. –í—ã–±–µ—Ä–∏ `test_valid.csv`
3. –û–∂–∏–¥–∞–µ–º–æ:
   - ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ "–§–∞–π–ª test_valid.csv –∑–∞–≥—Ä—É–∂–µ–Ω!"
   - ‚úÖ –ß–∞—Ç –æ—á–∏—â–µ–Ω, –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
   - ‚úÖ –í —Å–∞–π–¥–±–∞—Ä–µ: "üìä –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: test_valid.csv"

**–¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**
1. –ó–∞–≥—Ä—É–∑–∏ `test_invalid.csv`
2. –û–∂–∏–¥–∞–µ–º–æ:
   - ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –ø—Ä–æ –∫–æ–ª–æ–Ω–∫–∏

**–¢–µ—Å—Ç 3: –°–º–µ–Ω–∞ —Ñ–∞–π–ª–∞**
1. –ó–∞–≥—Ä—É–∑–∏ –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª
2. –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∞–≥–µ–Ω—Ç—É ‚Üí –ø–æ–ª—É—á–∏ –æ—Ç–≤–µ—Ç
3. –ó–∞–≥—Ä—É–∑–∏ –≤—Ç–æ—Ä–æ–π —Ñ–∞–π–ª
4. –û–∂–∏–¥–∞–µ–º–æ:
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞
   - ‚úÖ –ù–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
   - ‚úÖ –ê–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–¢–µ—Å—Ç 4: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å .txt**
1. –ü–æ–ø—ã—Ç–∞–π—Å—è –≤—ã–±—Ä–∞—Ç—å .txt —Ñ–∞–π–ª
2. –û–∂–∏–¥–∞–µ–º–æ:
   - üö´ –§–∞–π–ª –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∞ (st.file_uploader —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç)

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π UI

### Sidebar:
```
‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV/XLSX —Ñ–∞–π–ª
   [Browse files...]

üìä –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: my_data.csv

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç
```

### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ:
```
‚úÖ –§–∞–π–ª my_data.csv –∑–∞–≥—Ä—É–∂–µ–Ω!
```

### –ü—Ä–∏ –æ—à–∏–±–∫–µ:
```
‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: Missing required columns: account, period
üí° –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–æ–Ω–∫–∏: account, period, actual, budget
```

---

## üéì –ß—Ç–æ —Ç—ã –∏–∑—É—á–∏—à—å

1. ‚úÖ `st.file_uploader()` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Streamlit
2. ‚úÖ `tempfile` - —Ä–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
3. ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
5. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
6. ‚úÖ `st.rerun()` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ UI
7. ‚úÖ UX –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ñ–∞–π–ª–æ–≤—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫

---

## üéÅ –ë–æ–Ω—É—Å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
```python
if uploaded_file is not None:
    # –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    with st.expander("üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö"):
        import pandas as pd
        df = pd.read_csv(file_path) if file_path.suffix == '.csv' else pd.read_excel(file_path)
        st.dataframe(df.head(10))
```

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∞–π–ª—É
```python
st.info(f"""
üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–∞:**
- –°—Ç—Ä–æ–∫: {len(df)}
- –ü–µ—Ä–∏–æ–¥–æ–≤: {df['period'].nunique()}
- –°—á–µ—Ç–æ–≤: {df['account'].nunique()}
""")
```

### 3. Download template button
```python
template_csv = """account,period,actual,budget
Revenue,2024-01,1000,800
COGS,2024-01,400,500"""

st.download_button(
    label="üì• –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω CSV",
    data=template_csv,
    file_name="template.csv",
    mime="text/csv"
)
```

### 4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
```python
MAX_FILE_SIZE_MB = 10

st.file_uploader(
    "üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª",
    type=["csv", "xlsx"],
    help=f"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: {MAX_FILE_SIZE_MB} –ú–ë"
)

if uploaded_file and uploaded_file.size > MAX_FILE_SIZE_MB * 1024 * 1024:
    st.error(f"‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º {MAX_FILE_SIZE_MB} –ú–ë")
```

---

## ‚ùì –ï—Å–ª–∏ –∑–∞—Å—Ç—Ä—è–ª - —Å–ø—Ä–∞—à–∏–≤–∞–π!

**–ü–æ–ª–µ–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**
- "–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å UploadedFile –≤ tempfile?"
- "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏?"
- "–ü–æ—á–µ–º—É st.rerun() –Ω—É–∂–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞?"
- "–ö–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É ValueError –æ—Ç core.loader?"

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **st.file_uploader**: https://docs.streamlit.io/develop/api-reference/widgets/st.file_uploader
- **tempfile**: https://docs.python.org/3/library/tempfile.html
- **st.rerun**: https://docs.streamlit.io/develop/api-reference/execution-flow/st.rerun

---

**–í—Ä–µ–º—è –Ω–∞—á–∞—Ç—å!** ‚è∞

–ù–∞—á–Ω–∏ —Å **–®–∞–≥–∞ 1** (–æ–±–Ω–æ–≤–∏ file_uploader), –ø–æ—Ç–æ–º **–®–∞–≥ 2** (—Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è), –ø–æ—Ç–æ–º **–®–∞–≥ 3** (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏).

–£–¥–∞—á–∏! üöÄ
